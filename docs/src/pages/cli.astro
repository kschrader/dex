---
import Base from '../layouts/Base.astro';
import Terminal from '../components/Terminal.astro';
import { Code } from 'astro:components';
---

<Base title="CLI Reference" description="Complete dex command line interface reference">
  <h1>CLI</h1>

  <h2>Core Commands</h2>

  <div class="command-card">
    <h3>dex status</h3>
    <div class="synopsis">dex status [options]</div>
    <p>Show a dashboard overview of your tasks. <strong>This is the default command</strong> — running <code>dex</code> with no arguments runs <code>dex status</code>.</p>
    <ul>
      <li><code>--json</code> — Output as JSON for scripting</li>
    </ul>
    <p>The dashboard shows:</p>
    <ul>
      <li><strong>Stats</strong> — Total, pending, completed, blocked, and ready counts</li>
      <li><strong>Ready to Work</strong> — Pending tasks with no blockers (up to 5)</li>
      <li><strong>Blocked</strong> — Tasks waiting on dependencies</li>
      <li><strong>Recently Completed</strong> — Latest completed tasks (up to 5)</li>
    </ul>
    <Terminal title="Terminal">
      <Code
        code={`dex                    # Show dashboard (default)
dex status             # Same as above
dex status --json      # Output as JSON`}
        lang="bash"
        theme="vitesse-black"
      />
    </Terminal>
  </div>

  <div class="command-card">
    <h3>dex create</h3>
    <div class="synopsis">dex create &lt;name&gt; [--description &lt;details&gt;] [options]</div>
    <p>Create a new task with name and optional description.</p>
    <ul>
      <li><code>&lt;name&gt;</code> — One-line summary (required, positional)</li>
      <li><code>-d, --description</code> — Full implementation details (optional)</li>
      <li><code>-p, --priority &lt;n&gt;</code> — Lower = higher priority (default: 1)</li>
      <li><code>-b, --blocked-by &lt;ids&gt;</code> — Comma-separated task IDs that block this task</li>
      <li><code>--parent &lt;id&gt;</code> — Parent task ID (creates subtask)</li>
    </ul>
    <Terminal title="Terminal">
      <Code
        code={`dex create "Add JWT authentication" \\
  --description "Implement JWT middleware for route protection..."

dex create "Fix login bug"

dex create "Deploy to production" --blocked-by abc123

dex create "Add token refresh" --parent abc123`}
        lang="bash"
        theme="vitesse-black"
      />
    </Terminal>
  </div>

  <div class="command-card">
    <h3>dex list</h3>
    <div class="synopsis">dex list [options]</div>
    <p>List tasks in tree view (default shows pending only).</p>
    <ul>
      <li><code>--all</code> — Include completed tasks</li>
      <li><code>--completed</code> — Only completed tasks</li>
      <li><code>--ready</code> — Only unblocked tasks</li>
      <li><code>--blocked</code> — Only blocked tasks</li>
      <li><code>-i, --in-progress</code> — Only in-progress tasks</li>
      <li><code>--query &lt;text&gt;</code> — Search in name/description</li>
      <li><code>--issue &lt;number&gt;</code> — Find task by GitHub issue number</li>
      <li><code>--flat</code> — Plain list instead of tree</li>
    </ul>
    <p><strong>Indicators:</strong></p>
    <ul>
      <li><code>[>]</code> — Task is in progress (blue)</li>
      <li><code>[B: xyz]</code> — Task is blocked by task xyz</li>
      <li><code>[GH-42]</code> — Task is linked to GitHub issue #42</li>
    </ul>
    <Terminal title="Terminal">
      <Code
        code={`dex list
dex list --all
dex list --ready
dex list --query "login"
dex list --issue 42`}
        lang="bash"
        theme="vitesse-black"
      />
    </Terminal>
  </div>

  <div class="command-card">
    <h3>dex show</h3>
    <div class="synopsis">dex show &lt;id&gt;... [options]</div>
    <p>View full task details including context, result, blocking relationships, GitHub issue links, and subtasks. Supports multiple task IDs.</p>
    <ul>
      <li><code>-e, --expand</code> — Show descriptions for ancestor tasks in the tree view</li>
      <li><code>-f, --full</code> — Show full description and result (no truncation)</li>
      <li><code>--json</code> — Output as JSON for scripting</li>
    </ul>
    <p>If the task is linked to a GitHub issue (directly or via parent), the issue number, repo, and URL are displayed. Subtasks show "(via parent)" to indicate the link is inherited.</p>
    <Terminal title="Terminal">
      <Code
        code={`dex show abc123                # Show task details
dex show abc123 def456         # Show multiple tasks
dex show abc123 --expand       # Show ancestor descriptions`}
        lang="bash"
        theme="vitesse-black"
      />
    </Terminal>
  </div>

  <div class="command-card">
    <h3>dex start</h3>
    <div class="synopsis">dex start &lt;id&gt; [options]</div>
    <p>Mark a task as in progress. Use this to indicate you're actively working on a task.</p>
    <ul>
      <li><code>-f, --force</code> — Re-claim a task that's already in progress</li>
    </ul>
    <Terminal title="Terminal">
      <Code
        code={`dex start abc123           # Mark task as in progress
dex start abc123 --force   # Re-claim a task already in progress`}
        lang="bash"
        theme="vitesse-black"
      />
    </Terminal>
  </div>

  <div class="command-card">
    <h3>dex complete</h3>
    <div class="synopsis">dex complete &lt;id&gt; --result &lt;result&gt; [options]</div>
    <p>Mark a task as completed with a result summary.</p>
    <ul>
      <li><code>--result</code> — What was accomplished (required)</li>
      <li><code>--commit &lt;sha&gt;</code> — Link to git commit</li>
    </ul>
    <Terminal title="Terminal">
      <Code
        code={`dex complete abc123 --result "Implemented JWT middleware with token refresh.
All 42 tests passing."

dex complete abc123 --result "..." --commit a1b2c3d`}
        lang="bash"
        theme="vitesse-black"
      />
    </Terminal>
  </div>

  <div class="command-card">
    <h3>dex edit</h3>
    <div class="synopsis">dex edit &lt;id&gt; [options]</div>
    <p>Edit an existing task.</p>
    <ul>
      <li><code>-n, --name</code> — Updated name</li>
      <li><code>-d, --description</code> — Updated description</li>
      <li><code>--add-blocker &lt;id&gt;</code> — Add blocking dependency</li>
      <li><code>--remove-blocker &lt;id&gt;</code> — Remove blocking dependency</li>
    </ul>
    <Terminal title="Terminal">
      <Code
        code={`dex edit abc123 -n "Updated name"
dex edit abc123 --add-blocker xyz789
dex edit abc123 --remove-blocker xyz789`}
        lang="bash"
        theme="vitesse-black"
      />
    </Terminal>
  </div>

  <div class="command-card">
    <h3>dex delete</h3>
    <div class="synopsis">dex delete &lt;id&gt;</div>
    <p>Delete a task. Also deletes all subtasks.</p>
    <Terminal title="Terminal">
      <Code code="dex delete abc123" lang="bash" theme="vitesse-black" />
    </Terminal>
  </div>

  <div class="command-card">
    <h3>dex archive</h3>
    <div class="synopsis">dex archive &lt;id&gt;</div>
    <p>Archive a completed task and its descendants to reduce storage size. Archived tasks are compacted and moved to <code>archive.jsonl</code>.</p>
    <p><strong>Requirements:</strong></p>
    <ul>
      <li>Task and all descendants must be completed</li>
      <li>Task must not have any incomplete ancestors</li>
    </ul>
    <Terminal title="Terminal">
      <Code code="dex archive abc123" lang="bash" theme="vitesse-black" />
    </Terminal>
  </div>

  <div class="command-card">
    <h3>dex plan</h3>
    <div class="synopsis">dex plan &lt;markdown-file&gt; [options]</div>
    <p>Create a task from a markdown planning document. Automatically creates subtasks when the document contains distinct implementation steps.</p>
    <ul>
      <li><code>--priority &lt;n&gt;</code> — Set priority</li>
      <li><code>--parent &lt;id&gt;</code> — Create as subtask of existing task</li>
    </ul>
    <Terminal title="Terminal">
      <Code
        code={`dex plan ~/.claude/plans/auth-system.md
dex plan docs/SPEC.md --priority 2
dex plan feature.md --parent abc123`}
        lang="bash"
        theme="vitesse-black"
      />
    </Terminal>
  </div>

  <h2>GitHub</h2>

  <div class="command-card">
    <h3>dex sync</h3>
    <div class="synopsis">dex sync [options]</div>
    <p>Sync tasks to GitHub Issues. Requires <code>[sync.github]</code> configuration in <code>dex.toml</code>.</p>
    <Terminal title="Terminal">
      <Code code="dex sync" lang="bash" theme="vitesse-black" />
    </Terminal>
  </div>

  <div class="command-card">
    <h3>dex import</h3>
    <div class="synopsis">dex import &lt;github-issue-url&gt;</div>
    <p>Import a GitHub Issue as a dex task.</p>
    <Terminal title="Terminal">
      <Code code="dex import https://github.com/owner/repo/issues/123" lang="bash" theme="vitesse-black" />
    </Terminal>
  </div>

  <div class="command-card">
    <h3>dex export</h3>
    <div class="synopsis">dex export &lt;task-id&gt;... [options]</div>
    <p>Export tasks to GitHub Issues without enabling sync. Unlike <code>dex sync</code>, this creates issues but does not save the issue metadata back to the task.</p>
    <ul>
      <li><code>&lt;task-id&gt;...</code> — One or more task IDs to export (required)</li>
      <li><code>--dry-run</code> — Preview without creating issues</li>
    </ul>
    <p>Tasks that are already synced to GitHub are skipped with a warning.</p>
    <Terminal title="Terminal">
      <Code
        code={`dex export abc123                 # Export single task
dex export abc123 def456          # Export multiple tasks
dex export abc123 --dry-run       # Preview export`}
        lang="bash"
        theme="vitesse-black"
      />
    </Terminal>
  </div>

  <h2>Diagnostics</h2>

  <div class="command-card">
    <h3>dex doctor</h3>
    <div class="synopsis">dex doctor [options]</div>
    <p>Check dex configuration and storage for issues, with optional auto-repair.</p>
    <ul>
      <li><code>--fix</code> — Automatically fix detected issues</li>
    </ul>
    <p>Checks performed:</p>
    <ul>
      <li><strong>Config</strong> — Valid TOML syntax, deprecated settings, missing environment variables</li>
      <li><strong>Storage</strong> — Task file validity, relationship consistency, orphaned references, depth limits</li>
    </ul>
    <Terminal title="Terminal">
      <Code
        code={`dex doctor             # Check for issues (read-only)
dex doctor --fix       # Check and fix issues`}
        lang="bash"
        theme="vitesse-black"
      />
    </Terminal>
  </div>

  <h2>Configuration</h2>

  <div class="command-card">
    <h3>dex init</h3>
    <div class="synopsis">dex init [options]</div>
    <p>Initialize dex configuration. Creates a config file and optionally sets up shell completions.</p>
    <ul>
      <li><code>-y, --yes</code> — Accept all defaults (skip prompts)</li>
      <li><code>--config-dir &lt;path&gt;</code> — Override config directory</li>
    </ul>
    <Terminal title="Terminal">
      <Code
        code={`dex init              # Interactive setup
dex init -y           # Accept all defaults`}
        lang="bash"
        theme="vitesse-black"
      />
    </Terminal>
  </div>

  <div class="command-card">
    <h3>dex dir</h3>
    <div class="synopsis">dex dir [options]</div>
    <p>Print the dex directory path. By default, prints the task storage directory for the current repository.</p>
    <ul>
      <li><code>-g, --global</code> — Print the global config directory instead</li>
    </ul>
    <Terminal title="Terminal">
      <Code
        code={`dex dir                # Print task storage path (e.g., /path/to/repo/.dex)
dex dir --global       # Print global config path (~/.config/dex)
cd $(dex dir)          # Navigate to task directory
ls $(dex dir)          # List task directory contents`}
        lang="bash"
        theme="vitesse-black"
      />
    </Terminal>
  </div>

  <div class="command-card">
    <h3>dex config</h3>
    <div class="synopsis">dex config [options] &lt;key&gt;[=&lt;value&gt;]</div>
    <p>Get or set configuration values (similar to <code>git config</code>).</p>
    <ul>
      <li><code>-g, --global</code> — Use global config (~/.config/dex/dex.toml)</li>
      <li><code>-l, --local</code> — Use project config (.dex/config.toml)</li>
      <li><code>--unset &lt;key&gt;</code> — Remove a config key</li>
      <li><code>--list</code> — List all set config values</li>
    </ul>
    <p><strong>Config keys:</strong></p>
    <ul>
      <li><code>storage.engine</code> — file (only supported engine)</li>
      <li><code>storage.file.path</code> — Custom storage directory</li>
      <li><code>storage.file.mode</code> — in-repo | centralized</li>
      <li><code>sync.github.enabled</code> — Enable GitHub sync (boolean)</li>
      <li><code>sync.github.token_env</code> — Environment variable for GitHub token</li>
      <li><code>sync.github.label_prefix</code> — Label prefix for dex tasks</li>
      <li><code>sync.github.auto.on_change</code> — Sync on mutations (boolean)</li>
      <li><code>sync.github.auto.max_age</code> — Max age before stale (e.g., 30m, 1h)</li>
    </ul>
    <Terminal title="Terminal">
      <Code
        code={`dex config sync.github.enabled           # Get value
dex config sync.github.enabled=true      # Set value
dex config --local sync.github.enabled=true
dex config --unset sync.github.label_prefix
dex config --list                        # Show all values`}
        lang="bash"
        theme="vitesse-black"
      />
    </Terminal>
  </div>

  <h2>Other</h2>

  <div class="command-card">
    <h3>dex mcp</h3>
    <div class="synopsis">dex mcp</div>
    <p>Run dex as an MCP server for integration with other tools.</p>
    <Terminal title="Terminal">
      <Code code="dex mcp" lang="bash" theme="vitesse-black" />
    </Terminal>
  </div>

  <div class="command-card">
    <h3>dex completion</h3>
    <div class="synopsis">dex completion &lt;shell&gt;</div>
    <p>Generate shell completion script.</p>
    <Terminal title="Terminal">
      <Code
        code={`eval "$(dex completion bash)"
eval "$(dex completion zsh)"
dex completion fish | source`}
        lang="bash"
        theme="vitesse-black"
      />
    </Terminal>
  </div>

  <div class="command-card">
    <h3>dex help</h3>
    <div class="synopsis">dex help [command]</div>
    <p>Show help for dex or a specific command.</p>
    <Terminal title="Terminal">
      <Code
        code={`dex help
dex help create
dex help complete`}
        lang="bash"
        theme="vitesse-black"
      />
    </Terminal>
  </div>

  <div class="command-card">
    <h3>dex version</h3>
    <div class="synopsis">dex version</div>
    <p>Display the installed version of dex.</p>
    <Terminal title="Terminal">
      <Code
        code={`dex version            # Show version
dex --version          # Same as above
dex -V                 # Short flag`}
        lang="bash"
        theme="vitesse-black"
      />
    </Terminal>
  </div>

  <h2>Global Options</h2>
  <ul>
    <li><code>--version, -V</code> — Show version and exit</li>
    <li><code>--help, -h</code> — Show help message</li>
    <li><code>--storage-path &lt;path&gt;</code> — Override storage directory</li>
  </ul>

  <h2>Environment Variables</h2>
  <table>
    <thead>
      <tr>
        <th>Variable</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>DEX_STORAGE_PATH</code></td>
        <td>Override storage directory</td>
      </tr>
      <tr>
        <td><code>GITHUB_TOKEN</code></td>
        <td>GitHub API token for sync/import</td>
      </tr>
    </tbody>
  </table>
</Base>
