---
import Base from '../layouts/Base.astro';
import Terminal from '../components/Terminal.astro';
import { Code } from 'astro:components';
---

<Base title="CLI Reference" description="Complete dex command line interface reference">
  <h1>CLI</h1>

  <h2>Core Commands</h2>

  <div class="command-card">
    <h3>dex status</h3>
    <div class="synopsis">dex status [options]</div>
    <p>Show a dashboard overview of your tasks. <strong>This is the default command</strong> — running <code>dex</code> with no arguments runs <code>dex status</code>.</p>
    <ul>
      <li><code>--json</code> — Output as JSON for scripting</li>
    </ul>
    <p>The dashboard shows:</p>
    <ul>
      <li><strong>Stats</strong> — Total, pending, completed, blocked, and ready counts</li>
      <li><strong>Ready to Work</strong> — Pending tasks with no blockers (up to 5)</li>
      <li><strong>Blocked</strong> — Tasks waiting on dependencies</li>
      <li><strong>Recently Completed</strong> — Latest completed tasks (up to 5)</li>
    </ul>
    <Terminal title="Terminal">
      <Code
        code={`dex                    # Show dashboard (default)
dex status             # Same as above
dex status --json      # Output as JSON`}
        lang="bash"
        theme="vitesse-black"
      />
    </Terminal>
  </div>

  <div class="command-card">
    <h3>dex create</h3>
    <div class="synopsis">dex create -d &lt;description&gt; --context &lt;context&gt; [options]</div>
    <p>Create a new task with description and context.</p>
    <ul>
      <li><code>-d, --description</code> — One-line summary (required)</li>
      <li><code>--context</code> — Full implementation details (required)</li>
      <li><code>-p, --priority &lt;n&gt;</code> — Lower = higher priority (default: 1)</li>
      <li><code>-b, --blocked-by &lt;ids&gt;</code> — Comma-separated task IDs that block this task</li>
      <li><code>--parent &lt;id&gt;</code> — Parent task ID (creates subtask)</li>
    </ul>
    <Terminal title="Terminal">
      <Code
        code={`dex create -d "Add JWT authentication" \\
  --context "Implement JWT middleware for route protection..."

dex create -d "Deploy to production" --blocked-by abc123

dex create -d "Add token refresh" --parent abc123`}
        lang="bash"
        theme="vitesse-black"
      />
    </Terminal>
  </div>

  <div class="command-card">
    <h3>dex list</h3>
    <div class="synopsis">dex list [options]</div>
    <p>List tasks in tree view (default shows pending only).</p>
    <ul>
      <li><code>--all</code> — Include completed tasks</li>
      <li><code>--completed</code> — Only completed tasks</li>
      <li><code>--ready</code> — Only unblocked tasks</li>
      <li><code>--blocked</code> — Only blocked tasks</li>
      <li><code>--query &lt;text&gt;</code> — Search in description/context</li>
      <li><code>--flat</code> — Plain list instead of tree</li>
    </ul>
    <Terminal title="Terminal">
      <Code
        code={`dex list
dex list --all
dex list --ready
dex list --query "login"`}
        lang="bash"
        theme="vitesse-black"
      />
    </Terminal>
  </div>

  <div class="command-card">
    <h3>dex show</h3>
    <div class="synopsis">dex show &lt;id&gt;</div>
    <p>View full task details including context, result, blocking relationships, and subtasks.</p>
    <Terminal title="Terminal">
      <Code code="dex show abc123" lang="bash" theme="vitesse-black" />
    </Terminal>
  </div>

  <div class="command-card">
    <h3>dex complete</h3>
    <div class="synopsis">dex complete &lt;id&gt; --result &lt;result&gt; [options]</div>
    <p>Mark a task as completed with a result summary.</p>
    <ul>
      <li><code>--result</code> — What was accomplished (required)</li>
      <li><code>--commit &lt;sha&gt;</code> — Link to git commit</li>
    </ul>
    <Terminal title="Terminal">
      <Code
        code={`dex complete abc123 --result "Implemented JWT middleware with token refresh.
All 42 tests passing."

dex complete abc123 --result "..." --commit a1b2c3d`}
        lang="bash"
        theme="vitesse-black"
      />
    </Terminal>
  </div>

  <div class="command-card">
    <h3>dex edit</h3>
    <div class="synopsis">dex edit &lt;id&gt; [options]</div>
    <p>Edit an existing task.</p>
    <ul>
      <li><code>-d, --description</code> — Updated description</li>
      <li><code>--context</code> — Updated context</li>
      <li><code>--add-blocker &lt;id&gt;</code> — Add blocking dependency</li>
      <li><code>--remove-blocker &lt;id&gt;</code> — Remove blocking dependency</li>
    </ul>
    <Terminal title="Terminal">
      <Code
        code={`dex edit abc123 -d "Updated description"
dex edit abc123 --add-blocker xyz789
dex edit abc123 --remove-blocker xyz789`}
        lang="bash"
        theme="vitesse-black"
      />
    </Terminal>
  </div>

  <div class="command-card">
    <h3>dex delete</h3>
    <div class="synopsis">dex delete &lt;id&gt;</div>
    <p>Delete a task. Also deletes all subtasks.</p>
    <Terminal title="Terminal">
      <Code code="dex delete abc123" lang="bash" theme="vitesse-black" />
    </Terminal>
  </div>

  <div class="command-card">
    <h3>dex plan</h3>
    <div class="synopsis">dex plan &lt;markdown-file&gt; [options]</div>
    <p>Create a task from a markdown planning document. Automatically creates subtasks when the document contains distinct implementation steps.</p>
    <ul>
      <li><code>--priority &lt;n&gt;</code> — Set priority</li>
      <li><code>--parent &lt;id&gt;</code> — Create as subtask of existing task</li>
    </ul>
    <Terminal title="Terminal">
      <Code
        code={`dex plan ~/.claude/plans/auth-system.md
dex plan docs/SPEC.md --priority 2
dex plan feature.md --parent abc123`}
        lang="bash"
        theme="vitesse-black"
      />
    </Terminal>
  </div>

  <h2>GitHub</h2>

  <div class="command-card">
    <h3>dex sync</h3>
    <div class="synopsis">dex sync [options]</div>
    <p>Sync tasks to GitHub Issues. Requires <code>[sync.github]</code> configuration in <code>dex.toml</code>.</p>
    <Terminal title="Terminal">
      <Code code="dex sync" lang="bash" theme="vitesse-black" />
    </Terminal>
  </div>

  <div class="command-card">
    <h3>dex import</h3>
    <div class="synopsis">dex import &lt;github-issue-url&gt;</div>
    <p>Import a GitHub Issue as a dex task.</p>
    <Terminal title="Terminal">
      <Code code="dex import https://github.com/owner/repo/issues/123" lang="bash" theme="vitesse-black" />
    </Terminal>
  </div>

  <h2>Diagnostics</h2>

  <div class="command-card">
    <h3>dex doctor</h3>
    <div class="synopsis">dex doctor [options]</div>
    <p>Check dex configuration and storage for issues, with optional auto-repair.</p>
    <ul>
      <li><code>--fix</code> — Automatically fix detected issues</li>
    </ul>
    <p>Checks performed:</p>
    <ul>
      <li><strong>Config</strong> — Valid TOML syntax, deprecated settings, missing environment variables</li>
      <li><strong>Storage</strong> — Task file validity, relationship consistency, orphaned references, depth limits</li>
    </ul>
    <Terminal title="Terminal">
      <Code
        code={`dex doctor             # Check for issues (read-only)
dex doctor --fix       # Check and fix issues`}
        lang="bash"
        theme="vitesse-black"
      />
    </Terminal>
  </div>

  <h2>Configuration</h2>

  <div class="command-card">
    <h3>dex init</h3>
    <div class="synopsis">dex init [options]</div>
    <p>Initialize dex configuration. Creates a config file and optionally sets up shell completions.</p>
    <ul>
      <li><code>-y, --yes</code> — Accept all defaults (skip prompts)</li>
      <li><code>--config-dir &lt;path&gt;</code> — Override config directory</li>
    </ul>
    <Terminal title="Terminal">
      <Code
        code={`dex init              # Interactive setup
dex init -y           # Accept all defaults`}
        lang="bash"
        theme="vitesse-black"
      />
    </Terminal>
  </div>

  <div class="command-card">
    <h3>dex config</h3>
    <div class="synopsis">dex config [options] &lt;key&gt;[=&lt;value&gt;]</div>
    <p>Get or set configuration values (similar to <code>git config</code>).</p>
    <ul>
      <li><code>-g, --global</code> — Use global config (~/.config/dex/dex.toml)</li>
      <li><code>-l, --local</code> — Use project config (.dex/config.toml)</li>
      <li><code>--unset &lt;key&gt;</code> — Remove a config key</li>
      <li><code>--list</code> — List all set config values</li>
    </ul>
    <p><strong>Config keys:</strong></p>
    <ul>
      <li><code>storage.engine</code> — file | github-issues | github-projects</li>
      <li><code>storage.file.path</code> — Custom storage directory</li>
      <li><code>storage.file.mode</code> — in-repo | centralized</li>
      <li><code>sync.github.enabled</code> — Enable GitHub sync (boolean)</li>
      <li><code>sync.github.token_env</code> — Environment variable for GitHub token</li>
      <li><code>sync.github.label_prefix</code> — Label prefix for dex tasks</li>
      <li><code>sync.github.auto.on_change</code> — Sync on mutations (boolean)</li>
      <li><code>sync.github.auto.max_age</code> — Max age before stale (e.g., 30m, 1h)</li>
    </ul>
    <Terminal title="Terminal">
      <Code
        code={`dex config sync.github.enabled           # Get value
dex config sync.github.enabled=true      # Set value
dex config --local sync.github.enabled=true
dex config --unset sync.github.label_prefix
dex config --list                        # Show all values`}
        lang="bash"
        theme="vitesse-black"
      />
    </Terminal>
  </div>

  <h2>Other</h2>

  <div class="command-card">
    <h3>dex mcp</h3>
    <div class="synopsis">dex mcp</div>
    <p>Run dex as an MCP server for integration with other tools.</p>
    <Terminal title="Terminal">
      <Code code="dex mcp" lang="bash" theme="vitesse-black" />
    </Terminal>
  </div>

  <div class="command-card">
    <h3>dex completion</h3>
    <div class="synopsis">dex completion &lt;shell&gt;</div>
    <p>Generate shell completion script.</p>
    <Terminal title="Terminal">
      <Code
        code={`eval "$(dex completion bash)"
eval "$(dex completion zsh)"
dex completion fish | source`}
        lang="bash"
        theme="vitesse-black"
      />
    </Terminal>
  </div>

  <div class="command-card">
    <h3>dex help</h3>
    <div class="synopsis">dex help [command]</div>
    <p>Show help for dex or a specific command.</p>
    <Terminal title="Terminal">
      <Code
        code={`dex help
dex help create
dex help complete`}
        lang="bash"
        theme="vitesse-black"
      />
    </Terminal>
  </div>

  <h2>Global Options</h2>
  <ul>
    <li><code>--storage-path &lt;path&gt;</code> — Override storage directory</li>
  </ul>

  <h2>Environment Variables</h2>
  <table>
    <thead>
      <tr>
        <th>Variable</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>DEX_STORAGE_PATH</code></td>
        <td>Override storage directory</td>
      </tr>
      <tr>
        <td><code>GITHUB_TOKEN</code></td>
        <td>GitHub API token for sync/import</td>
      </tr>
    </tbody>
  </table>
</Base>
